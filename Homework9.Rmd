---
title: "SDS 315 Homework 9"
author: "Yash Gupta - yg9449"
date: "2025-04-20"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
options(scipen = 999)
library(tidyverse)
library(ggplot2)
library(kableExtra)
library(mosaic)
library(moderndive)
library(effectsize)
```

Link to github repository with Rmd file: https://github.com/ygnewyork/SDS_HW9

## Question 1

### Part A

```{r cars}

solder <- read_csv("solder.csv")

ggplot(solder, aes(x = Opening, y = skips)) +
  geom_boxplot() +
  labs(
    title = "Number of Solder Skips by Gun Opening Size",
    x = "Opening Size",
    y = "Number of Skips"
  )

```

This boxplot demonstrates the number of solder skips are seen by opening size, and we see that large openings have the lowest median number of skips, followed by medium openings, and small openings have the highest median number of skips.

```{r}

ggplot(solder, aes(x = Solder, y = skips)) +
  geom_boxplot() +
  labs(
    title = "Number of Solder Skips by Alloy Thickness",
    x = "Solder Thickness",
    y = "Number of Skips"
  )

```

This boxplot demonstrates the number of solder skips are seen by alloy thickness, and we see that Thin thickeness alloys have a much higher median of skips than the Thick thickness alloys, along with having more and higher outliers.

### Part B

```{r}

skips_model <- lm(skips ~ Opening + Solder + Opening:Solder, data = solder)

get_regression_table(skips_model)

```

Table with estimates and 95% confints.

### Part C

The estimated average number of solder skips from the baseline condition (large opening, thick solder) is 0.393 skips.

The main effect estimate for Medium opening (compared to the Large opening baseline) is 2.407 skips, which is the estimated increase in average skips when switching from large to medium opening when using Thick solder.

The main effect estimate for Small opening (compared to the Large opening baseline) is 5.127 skips, which is the estimated increase in average skips when switching from large to small opening when using Thick solder.

The main effect estimate for Thin solder compared to the baseline Thick solder is 2.280 skips, which is the estimated increase in average skips when switching from Thick to Thin solder.

The interaction effect estimate for the Medium opening and Thin Solder is -.740 skips, which indicates that a combination of Medium opening and Thin solder results in an average number of skips that is 0.74 lower than simply adding individual main effects of medium opening and thin solder effects.

The interaction effect estimate for the Small opening and Thin solder is 9.653 skips, which indicates that a combination of Small opening and Thin solder results in an average number of skips that is 9.653 higher than simply adding the individual main effects of Small opening and Thin solder together.

### Part D

6 combinations of solder type and opening size:

1.  Large Opening, Thick Solder: 0.393 \# of skips

2.  Large Opening, Thin Solder: (0.393 + 2.280) = 2.673 \# of skips

3.  Medium Opening, Thick Solder: (0.393 + 2.407) = 2.800 \# of skips

4.  Medium Opening, Thin Solder: 0.393 + 2.407 + 2.280 - .740 = 4.340 \# of skips

5.  Small Opening, Thin Solder: 0.393 + 5.127 = 5.520 \# of skips

6.  Small Opening, Thick Solder: 0.393 + 5.127 + 2.280 + 9.653 = 17.453 \# of skips

Based on these combinations, I would recommend having the Large Opening size and the Thick Solder. This gives the lowest average number of skips in the process, of 0.393 as an average.

## Question 2

```{r}

groceries <- read_csv("groceries.csv")

```

### Part A

```{r}

avg_price_per_store <- groceries %>%
  group_by(Store) %>%
  summarise(AveragePrice = mean(Price, na.rm = TRUE)) %>%
  arrange(AveragePrice) 

ggplot(avg_price_per_store, aes(x = reorder(Store, AveragePrice), y = AveragePrice)) +
  geom_bar(stat = "identity", fill = "orange") +
  coord_flip() + 
  labs(
    title = "Average Product Price by Store",
    x = "Store",
    y = "Average Price ($)") +
  theme_minimal()

```

Average price across various products at each store shown here in a bar graph - Whole Foods has the highest average price, and Fiesta has the lowest average price.

### Part B

```{r}

stores_per_product <- groceries %>%
  group_by(Product) %>%
  summarise(NumStores = n()) %>% 
  arrange(NumStores)

ggplot(stores_per_product, aes(x = reorder(Product, NumStores), y = NumStores)) +
  geom_bar(stat = "identity", fill = "blue") +
  coord_flip() +
  labs(
    title = "Number of Stores Selling Each Product",
    x = "Product",
    y = "Number of Stores"
  ) +
  theme_minimal()

```

This graph shows the availability of products across the 16 stores - Horizon 2% Milk and eggs are available at all stores, and certain cereals and tortilla chips are the least available by number of stores.

### Part C

```{r}

model_grocery_c <- lm(Price ~ Product + Type, data = groceries)

confint(model_grocery_c, "TypeGrocery")

```

Compared with ordinary grocery stores (like Albertsons, HEB, or Krogers), convenience stores charge somewhere between 0.41 and 0.92 dollars more for the same product.

### Part D

```{r}

model_grocery_d <- lm(Price ~ Product + Store, data = groceries)

reg_table <- get_regression_table(model_grocery_d)

store_coeffs <- reg_table[grepl("^Store", reg_table$term), ]

groceries$Store <- as.factor(groceries$Store)
ref_store <- levels(groceries$Store)[1]

ref_row <- data.frame(
    term = ref_store,
    estimate = 0,
    std_error = NA,
    statistic = NA,
    p_value = NA,
    lower_ci = NA,
    upper_ci = NA
)

names(ref_row) <- names(store_coeffs)

all_store_effects <- rbind(store_coeffs, ref_row)

all_store_effects$term <- gsub("Store: ", "", all_store_effects$term)

all_store_effects <- all_store_effects %>%
  arrange(estimate)

lowest_stores <- head(all_store_effects$term, 2)
highest_stores <- tail(all_store_effects$term, 2)

```

Based on the regression model, the two stores with the lowest prices when comparing the same product are Walmart and Kroger Fresh Fare. The two stores with the highest prices when comparing the same product are the Wheatsville Food Co-Op and Whole Foods.

### Part E

```{r}

heb_effect <- all_store_effects$estimate[all_store_effects$term == "H-E-B"]
central_market_effect <- all_store_effects$estimate[all_store_effects$term == "Central Market"]

diff_cen_heb <- central_market_effect - heb_effect

range_store_effects <- (max(all_store_effects$estimate) - min(all_store_effects$estimate))

```

Central Market does charge a bit more per product than HEB does, about 7.3 cents more. However, in the grand context, when looking at all the stores in the dataset the store effects range from 1.36 dollars more for the same product from the lowest amount when comparing the most and least expensive stores, so 7.3 cents of difference isn't that huge in context.

### Part F

```{r}

groceries <- groceries %>% mutate(Income10K = Income / 10000)

model_grocery_f <- lm(Price ~ Product + Income10K, data = groceries)

summary_f <- summary(model_grocery_f)

income_coeff_info <- summary_f$coefficients["Income10K",]

income_coeff <- income_coeff_info["Estimate"]

income_coeff_sign <- sign(income_coeff)

standardize_parameters(model_grocery_f)

```

Based on the negative sign of the Income10K coefficient, consumers in poorer ZIP codes seem to pay more for the same product, on average, as the sign indicates the higher the income, the less people pay.

A one-standard deviation increase in the income of a ZIP code seems to be associated with a -0.03 standard-deviation change in the price that consumers in that ZIP code expect to pay for the same product.

## Question 3

### Part A

True, as figure A1 shows a clear positive trend between minority percentage and FAIR policies, and the regression model_A below figure A1 of policies on minority has an estimate of 0.014 per percentage-point minority, with a 95% confidence interval of (0.009, 0.018) and p-value of 0, indicating that there is statistically significant evidence that higher percentage of minorities increase the amount of FAIR policies.

### Part B

This is undecidable, since there is no regression model between minority share and housing-stock age in predicting policies. Figure B1 and model_b only show a direct relationship between minority and age, but not their combined effect on FAIR policies. Additionally, Model_e also shows minority and age as predictors, but only as main effects as opposed to an interaction term. To properly evaluate this statement, we would need a regression model with an interaction term (minority + age + minority:age).

### Part C

False, since in Figure C1 the slopes of both high and low fire risk groups as compared to the minority percentage vs. FAIR policies are roughly the same, and Table model_C shows that the interaction of minority and fire-risk low (minority:fire_riskLow) is -0.001 with a 95% confidence interval of (-0.012, 0.01) and a p-value of 0.839, indicating no statistical significance. There is no evidence showing that the strength of the relationship between minority percentage and FAIR policies differ significantly between high and low-fire-risk ZIP codes. A correction to this statement would be that the relationship between minority percentage and number of FAIR policies per 100 housing units appears similar in both high and low fire risk ZIP codes, as shown by the non-significant interaction term in model_C.

### Part D

False, since while adding income to the model does reduce the minority coefficient (as seen from model_D1 to model_D2, from 0.014 to 0.01), the minority coefficient estimate still has a p-value of 0.002 and 95% confint of (0.004, 0.015), not containing zero, meaning that the minority variable is still statistically significant. Since a significant association between minority and policies still exists after accounting for income, income does not "explain away" the relationship. A correction to this statement would be that controlling for the income weakens the association between minority percentage and FAIR policy uptake, but association still remains statistically significant.

### Part E

True, since in model_E, we see that even when accounting for fire, income, and age, the minority coefficient estimate is still positive and significant of 0.008, with a 95% CI of (0.003, 0.014) and p-value of 0.006. This shows that there is an statistically significant positve association between minority percentage and FAIR policies even after accounting for differences in income, fire risk and housing age across zip codes.
